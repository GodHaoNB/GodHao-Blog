# 网络编程

## **网络的基本概念** 

网络的物理结构——数据是如何从一台机器传输到另外一台机器的

### 主板上的网口

<img src="F:\我的\博客记录\linux\image\主板上的网络接口.png" alt="主板上的网络接口" style="zoom: 50%;" />

### 网线

<img src="F:\我的\博客记录\linux\image\网线.png" alt="网线" style="zoom: 50%;" />



### 一块独立的网卡

<img src="F:\我的\博客记录\linux\image\独立的网卡.png" alt="独立的网卡" style="zoom:50%;" />

### 常见的网络连接方案

<img src="F:\我的\博客记录\linux\image\路由.png" alt="路由" style="zoom: 50%;" />

**数据→系统→网卡→路由器→modem→互联网→ modem→路由器→网卡→系统→接收程序**

### 网络中的地址

<img src="F:\我的\博客记录\linux\image\网络中的地址.png" alt="网络中的地址" style="zoom:67%;" />

A 类、B 类、C 类用于不同规模的网络

D 类用于组播（类似广播）

E 类保留，用于实验、私有网络 

注意上述地址中缺少两个点，分别是 **0.0.0.0** 和 **127.0.0.X** 

0.0.0.0 用于**服务器监听**的时候使用 ：**意思是监听本机上所有的地址** 

大型服务器大部分都是有多个地址的

 <img src="F:\我的\博客记录\linux\image\服务器.png" alt="服务器" style="zoom:50%;" />

127.0.0.1 是本机网络，往这个网络发任何数据，都会被回发回来 。

### **网络中的端口** 

<img src="F:\我的\博客记录\linux\image\网络端口.png" alt="网络端口" style="zoom:67%;" />

- **公认端口**（Well Known Ports）：这类端口也常称之为"**常用端口**"。

  这类端口的端口号从 **0**  到  **1024**，它们紧密绑定于一些特定的服务。通常这些端口的通信明确表明了某种服务的协议，<u>这种端口是不可再重新定义它的作用对象</u>。

  例如：80 端口实际上总是 HTTP 通信所使用的，而 23 号端口则是 Telnet 服务专用的。这些端口通常不会像木马这样的黑客程序利用。

- **注册端口**（Registered Ports）：端口号从  **1025**  到  **49151**。

  它们**松散地**绑定于一些服务。也是说有许多服务绑定于这些端口，这些端口同样用于许多其他目的。<u>这些端口多数没有明确的定义服务对象，不同程序可根据实际需要自己定义</u>， 如后面要介绍的远程控制软件和木马程序中都会有这些端口的定义的。 

  **记住这些常见的程序端口在木马程序的防护和查杀上是非常有必要的。常见木马所使用 的端口在后面将有详细的列表**。

  

- **动态和/或私有端口**（Dynamic and/or Private Ports）：端口号从 **49152**  到  **65535**

  理论上，**不应把常用服务分配在这些端口上**。实际上，有些较为特殊的程序，特别是一些木马程序就非常喜欢用这些端口，因为这些端口**常常不被引起注意，容易隐蔽**。

## 什么是协议？

### TCP 协议包头说明

<img src="F:\我的\博客记录\linux\image\协议包头.png" alt="协议包头" style="zoom:67%;" />

#### HTTP 协议的包头样例 

 ```c++
GET /search/detail?ct=503316480&z=0&ipn=d 

HTTP/1.1 

Host: pic.baidu.com 

Connection: keep-alive 

Cache-Control: max-age=0 

Upgrade-Insecure-Requests: 1 

User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) 

Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3766.400 QQBrowser/10.6.4163.400 

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8 

Accept-Encoding: gzip, deflate, br 

Accept-Language: zh-CN,zh;q=0.9 
 ```

#### SSH 数据包头结构

 ![ssh数据包](F:\我的\博客记录\linux\image\ssh数据包.png)

协议就是一种网络交互中数据格式和交互流程的约定通过协议，我们可以与远程的设备进行数据交互请求或者完成对方的服务。

## **TCP** **协议基础** 

**传输控制协议**（TCP，Transmission Control Protocol）<u>是一种面向连接的、可靠的、基于字节流的传输层通信协议</u> 。

#### 交互流程： 

![交互流程](F:\我的\博客记录\linux\image\交互流程.png)

## **套接字介绍** 

### **什么是套接字** 

网络编程就是编写程序使**两台连网的计算机相互交换数据**。两台计算机之间用什么传 输数据呢?首先需要物理连接。在此基础上，只需考虑如何编写数据传输软件。但实际上这也不用愁，因为操作系统会提供名为"套接字"（socket）的部件。**套接字是网络数据传输用的软件设备**。即使对网络数据传输原理不太熟悉，我们也能通过套接字完成数据传输。因此， **<u>网络编程又称为套接字编程</u>**。那为什么要用"套接字"这个词呢?

<img src="F:\我的\博客记录\linux\image\c1.png" alt="c1" style="zoom: 50%;" />

<img src="F:\我的\博客记录\linux\image\c2.png" alt="c2" style="zoom:50%;" />



### **套接字的创建** 

套接字大致分为两种，其中，先要讨论的 TCP 套接字可以比喻成**电话机**。实际上，电话机也是通过固定电话网（telephone network）完成语音数据交换的。就如同于：**<u>创建一个套接字就相当于是安装了一部电话机</u>**。